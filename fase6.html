<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fase 6 - Bracket + Tabelle (Andata e Ritorno)</title>
<style>
body {
  font-family: "Segoe UI", Arial, sans-serif;
  background-color: #0b0c10;
  color: white;
  margin: 0;
  padding: 20px;
}
h1 { text-align: center; color: #00aaff; margin-bottom: 30px; }
h2 { color: #00aaff; margin-top: 60px; }

.home-button {
  position: fixed; top: 20px; left: 20px;
  background-color: rgba(0,170,255,0.2); color: white;
  text-decoration: none; padding: 8px 16px; border-radius: 8px;
  font-weight: bold; transition: background 0.3s; z-index: 1000;
}
.home-button:hover { background-color: rgba(0,170,255,0.4); }

/* Bracket */
.bracket { display: flex; gap: 60px; overflow-x: auto; align-items: flex-start; position: relative; margin-bottom: 80px; }
.round { display: flex; flex-direction: column; align-items: flex-start; position: relative; }
.match { background: rgba(0,170,255,0.1); border: 1px solid rgba(255,255,255,0.2); border-radius: 6px;
       padding: 6px 10px; width: 150px; text-align: center; margin-bottom: 20px; position: relative; }
.team { margin: 4px 0; }
.agg { font-size: 0.8em; color: #88ccff; }

/* Linee */
.line-vertical, .line-horizontal {
  position: absolute;
  background: rgba(0,170,255,0.5);
}
.line-vertical { width: 2px; }
.line-horizontal { height: 2px; }

/* Tabelle sotto */
table {
  border-collapse: collapse;
  width: 100%;
  margin-bottom: 40px;
  background: rgba(255,255,255,0.05);
}
th, td {
  border: 1px solid rgba(255,255,255,0.2);
  padding: 8px 12px;
  text-align: center;
}
th { background-color: rgba(0,170,255,0.2); color: #00ccff; }
</style>
</head>
<body>

<a href="index.html" class="home-button">üè† Home</a>
<h1>Fase 6 - Bracket (Andata e Ritorno)</h1>

<div class="bracket" id="bracket"></div>

<div id="tables"></div>

<script>
const bracket = document.getElementById('bracket');
const tablesDiv = document.getElementById('tables');

function creaMatch(team1, team2, agg){ 
  return `<div class="match">
            <div class="team">${team1}</div>
            <div class="team">${team2}</div>
            ${agg ? `<div class="agg">${agg}</div>` : ""}
          </div>`; 
}

function creaLinea(parent, x, y, width, height, vertical=true){
  const div = document.createElement('div');
  div.className = vertical ? 'line-vertical' : 'line-horizontal';
  if(vertical){
    div.style.left = x + 'px'; div.style.top = y + 'px'; div.style.height = height + 'px';
  } else {
    div.style.left = x + 'px'; div.style.top = y + 'px'; div.style.width = width + 'px';
  }
  parent.appendChild(div);
}

function disegnaLinee(){
  const rounds = bracket.children;
  for(let c=0; c<rounds.length-1; c++){
    const currentRound = rounds[c].children;
    const nextRound = rounds[c+1].children;

    for(let i=0; i<Math.min(currentRound.length, nextRound.length*2); i++){
      const currMatch = currentRound[i];
      const nextMatch = nextRound[Math.floor(i/2)];
      const currTop = currMatch.offsetTop + currMatch.offsetHeight/2;
      const nextTop = nextMatch.offsetTop + nextMatch.offsetHeight/2;
      const x = currMatch.offsetLeft + currMatch.offsetWidth;
      const height = nextTop - currTop;
      creaLinea(bracket, x, currTop, 0, height, true);
      creaLinea(bracket, x, nextTop, 40, 0, false);
    }
  }
}

// Tabella con andata/ritorno
function creaTabella(titolo, partite){
  let html = `<h2>${titolo}</h2><table><tr><th>#</th><th>Squadra 1</th><th>Squadra 2</th><th>Andata</th><th>Ritorno</th><th>Totale</th></tr>`;
  partite.forEach((p, i)=>{
    const andata = p.andata || "-";
    const ritorno = p.ritorno || "-";
    let tot = "-";
    if(andata.includes('-') && ritorno.includes('-')){
      const [a1,a2] = andata.split('-').map(n=>parseInt(n)||0);
      const [r1,r2] = ritorno.split('-').map(n=>parseInt(n)||0);
      tot = `${a1+r1}‚Äì${a2+r2}`;
    }
    html += `<tr><td>${i+1}</td><td>${p.team1}</td><td>${p.team2}</td><td>${andata}</td><td>${ritorno}</td><td>${tot}</td></tr>`;
  });
  html += `</table>`;
  return html;
}

fetch("fase6.json")
.then(res => res.json())
.then(data => {
  const rounds = ["sedicesimi", "ottavi", "quarti", "semifinali", "finale"];
  rounds.forEach((round, idx) => {
    const div = document.createElement('div');
    div.className = 'round';
    data[round].forEach(m => {
      // Calcolo punteggio aggregato
      let agg = "";
      if(m.andata && m.ritorno){
        const [a1,a2] = m.andata.split('-').map(n=>parseInt(n)||0);
        const [r1,r2] = m.ritorno.split('-').map(n=>parseInt(n)||0);
        agg = `${a1+r1}‚Äì${a2+r2}`;
      }
      div.innerHTML += creaMatch(m.team1, m.team2, agg);
    });
    bracket.appendChild(div);
  });

  tablesDiv.innerHTML = `
    ${creaTabella("Sedicesimi di finale", data.sedicesimi)}
    ${creaTabella("Ottavi di finale", data.ottavi)}
    ${creaTabella("Quarti di finale", data.quarti)}
    ${creaTabella("Semifinali", data.semifinali)}
    ${creaTabella("Finale", data.finale)}
  `;

  setTimeout(disegnaLinee, 300);
})
.catch(err => console.error("Errore nel caricamento del JSON", err));
</script>

</body>
</html>
